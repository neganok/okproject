version: v1.0
name: VSCode Remote No-Auth Pipeline

agent:
  machine:
    type: a2-standard-4
    os_image: macos-xcode15

blocks:
  - name: Setup VSCode Remote and Tunnel
    task:
      jobs:
        - name: Start Code-Server and Ngrok Tunnel
          commands:
            - brew install code-server || echo "code-server đã được cài đặt"
            - brew install --cask ngrok || echo "ngrok đã được cài đặt"
            - ngrok authtoken 2uHjB4JR89xhlXU6tlCsRHmV0pO_5XNsrC3sj48837yTcojD6
            - nohup code-server --bind-addr 0.0.0.0:9999 --auth none > code-server.log 2>&1 &
            - sleep 10
            - echo "code-server đã khởi chạy với --auth none (không cần mật khẩu)."
            - nohup ngrok http 9999 > ngrok.log 2>&1 &
            - sleep 3600
